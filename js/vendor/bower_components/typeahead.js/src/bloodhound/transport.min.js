var Transport=(function(){var c=0,f={},a=6,e=new LruCache(10);function h(i){i=i||{};this.cancelled=false;this.lastReq=null;this._send=i.transport;this._get=i.limiter?i.limiter(this._get):this._get;this._cache=i.cache===false?new LruCache(0):e}h.setMaxPendingRequests=function b(i){a=i};h.resetCache=function g(){e.reset()};_.mixin(h.prototype,{_fingerprint:function d(i){i=i||{};return i.url+i.type+$.param(i.data||{})},_get:function(q,j){var p=this,m,n;m=this._fingerprint(q);if(this.cancelled||m!==this.lastReq){return}if(n=f[m]){n.done(l).fail(k)}else{if(c<a){c++;f[m]=this._send(q).done(l).fail(k).always(i)}else{this.onDeckRequestArgs=[].slice.call(arguments,0)}}function l(o){j(null,o);p._cache.set(m,o)}function k(){j(true)}function i(){c--;delete f[m];if(p.onDeckRequestArgs){p._get.apply(p,p.onDeckRequestArgs);p.onDeckRequestArgs=null}}},get:function(l,i){var k,j;i=i||$.noop;l=_.isString(l)?{url:l}:(l||{});j=this._fingerprint(l);this.cancelled=false;this.lastReq=j;if(k=this._cache.get(j)){i(null,k)}else{this._get(l,i)}},cancel:function(){this.cancelled=true}});return h})();