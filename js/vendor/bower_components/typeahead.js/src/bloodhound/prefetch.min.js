var Prefetch=(function(){var e;e={data:"data",protocol:"protocol",thumbprint:"thumbprint"};function f(g){this.url=g.url;this.ttl=g.ttl;this.cache=g.cache;this.prepare=g.prepare;this.transform=g.transform;this.transport=g.transport;this.thumbprint=g.thumbprint;this.storage=new PersistentStorage(g.cacheKey)}_.mixin(f.prototype,{_settings:function d(){return{url:this.url,type:"GET",dataType:"json"}},store:function b(g){if(!this.cache){return}this.storage.set(e.data,g,this.ttl);this.storage.set(e.protocol,location.protocol,this.ttl);this.storage.set(e.thumbprint,this.thumbprint,this.ttl)},fromCache:function c(){var g={},h;if(!this.cache){return null}g.data=this.storage.get(e.data);g.protocol=this.storage.get(e.protocol);g.thumbprint=this.storage.get(e.thumbprint);h=g.thumbprint!==this.thumbprint||g.protocol!==location.protocol;return g.data&&!h?g.data:null},fromNetwork:function(g){var j=this,h;if(!g){return}h=this.prepare(this._settings());this.transport(h).fail(i).done(k);function i(){g(true)}function k(l){g(null,j.transform(l))}},clear:function a(){this.storage.clear();return this}});return f})();