var Menu=(function(){function c(y,v){var w=this;y=y||{};if(!y.node){$.error("node is required")}v.mixin(this);this.$node=$(y.node);this.query=null;this.datasets=_.map(y.datasets,x);function x(A){var z=w.$node.find(A.node).first();A.node=z.length?z:$("<div>").appendTo(w.$node);return new Dataset(A,v)}}_.mixin(c.prototype,EventEmitter,{_onSelectableClick:function o(v){this.trigger("selectableClicked",$(v.currentTarget))},_onRendered:function b(x,y,v,w){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty());this.trigger("datasetRendered",y,v,w)},_onCleared:function q(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty());this.trigger("datasetCleared")},_propagate:function m(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function d(){return _.every(this.datasets,v);function v(w){return w.isEmpty()}},_getSelectables:function r(){return this.$node.find(this.selectors.selectable)},_removeCursor:function j(){var v=this.getActiveSelectable();v&&v.removeClass(this.classes.cursor)},_ensureVisible:function p(y){var v,x,w,z;v=y.position().top;x=v+y.outerHeight(true);w=this.$node.scrollTop();z=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10);if(v<0){this.$node.scrollTop(w+v)}else{if(z<x){this.$node.scrollTop(w+(x-z))}}},bind:function(){var w=this,v;v=_.bind(this._onSelectableClick,this);this.$node.on("click.tt",this.selectors.selectable,v);_.each(this.datasets,function(x){x.onSync("asyncRequested",w._propagate,w).onSync("asyncCanceled",w._propagate,w).onSync("asyncReceived",w._propagate,w).onSync("rendered",w._onRendered,w).onSync("cleared",w._onCleared,w)});return this},isOpen:function n(){return this.$node.hasClass(this.classes.open)},open:function k(){this.$node.addClass(this.classes.open)},close:function l(){this.$node.removeClass(this.classes.open);this._removeCursor()},setLanguageDirection:function u(v){this.$node.attr("dir",v)},selectableRelativeToCursor:function a(z){var x,w,y,v;w=this.getActiveSelectable();x=this._getSelectables();y=w?x.index(w):-1;v=y+z;v=(v+1)%(x.length+1)-1;v=v<-1?x.length-1:v;return v===-1?null:x.eq(v)},setCursor:function t(v){this._removeCursor();if(v=v&&v.first()){v.addClass(this.classes.cursor);this._ensureVisible(v)}},getSelectableData:function g(v){return(v&&v.length)?Dataset.extractData(v):null},getActiveSelectable:function f(){var v=this._getSelectables().filter(this.selectors.cursor).first();return v.length?v:null},getTopSelectable:function i(){var v=this._getSelectables().first();return v.length?v:null},update:function e(w){var v=w!==this.query;if(v){this.query=w;_.each(this.datasets,x)}return v;function x(y){y.update(w)}},empty:function h(){_.each(this.datasets,v);this.query=null;this.$node.addClass(this.classes.empty);function v(w){w.clear()}},destroy:function s(){this.$node.off(".tt");this.$node=$("<div>");_.each(this.datasets,v);function v(w){w.destroy()}}});return c})();