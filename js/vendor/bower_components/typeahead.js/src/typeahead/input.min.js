var Input=(function(){var y;y={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};function u(D,C){D=D||{};if(!D.input){$.error("input is missing")}C.mixin(this);this.$hint=$(D.hint);this.$input=$(D.input);this.query=this.$input.val();this.queryWhenFocused=this.hasFocus()?this.query:null;this.$overflowHelper=n(this.$input);this._checkLanguageDirection();if(this.$hint.length===0){this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=_.noop}}u.normalizeQuery=function(C){return(_.toStr(C)).replace(/^\s*/g,"").replace(/\s{2,}/g," ")};_.mixin(u.prototype,EventEmitter,{_onBlur:function l(){this.resetInputValue();this.trigger("blurred")},_onFocus:function g(){this.queryWhenFocused=this.query;this.trigger("focused")},_onKeydown:function A(C){var D=y[C.which||C.keyCode];this._managePreventDefault(D,C);if(D&&this._shouldTrigger(D,C)){this.trigger(D+"Keyed",C)}},_onInput:function c(){this._setQuery(this.getInputValue());this.clearHintIfInvalid();this._checkLanguageDirection()},_managePreventDefault:function i(E,D){var C;switch(E){case"up":case"down":C=!o(D);break;default:C=false}C&&D.preventDefault()},_shouldTrigger:function B(E,D){var C;switch(E){case"tab":C=!o(D);break;default:C=true}return C},_checkLanguageDirection:function b(){var C=(this.$input.css("direction")||"ltr").toLowerCase();if(this.dir!==C){this.dir=C;this.$hint.attr("dir",C);this.trigger("langDirChanged",C)}},_setQuery:function q(F,D){var C,E;C=k(F,this.query);E=C?this.query.length!==F.length:false;this.query=F;if(!D&&!C){this.trigger("queryChanged",this.query)}else{if(!D&&E){this.trigger("whitespaceChanged",this.query)}}},bind:function(){var F=this,G,C,E,D;G=_.bind(this._onBlur,this);C=_.bind(this._onFocus,this);E=_.bind(this._onKeydown,this);D=_.bind(this._onInput,this);this.$input.on("blur.tt",G).on("focus.tt",C).on("keydown.tt",E);if(!_.isMsie()||_.isMsie()>9){this.$input.on("input.tt",D)}else{this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(H){if(y[H.which||H.keyCode]){return}_.defer(_.bind(F._onInput,F,H))})}return this},focus:function p(){this.$input.focus()},blur:function v(){this.$input.blur()},getLangDir:function t(){return this.dir},getQuery:function r(){return this.query||""},setQuery:function q(D,C){this.setInputValue(D);this._setQuery(D,C)},hasQueryChangedSinceLastFocus:function w(){return this.query!==this.queryWhenFocused},getInputValue:function h(){return this.$input.val()},setInputValue:function j(C){this.$input.val(C);this.clearHintIfInvalid();this._checkLanguageDirection()},resetInputValue:function f(){this.setInputValue(this.query)},getHint:function d(){return this.$hint.val()},setHint:function x(C){this.$hint.val(C)},clearHint:function m(){this.setHint("")},clearHintIfInvalid:function a(){var F,E,C,D;F=this.getInputValue();E=this.getHint();C=F!==E&&E.indexOf(F)===0;D=F!==""&&C&&!this.hasOverflow();!D&&this.clearHint()},hasFocus:function e(){return this.$input.is(":focus")},hasOverflow:function s(){var C=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=C},isCursorAtEnd:function(){var D,E,C;D=this.$input.val().length;E=this.$input[0].selectionStart;if(_.isNumber(E)){return E===D}else{if(document.selection){C=document.selection.createRange();C.moveStart("character",-D);return D===C.text.length}}return true},destroy:function z(){this.$hint.off(".tt");this.$input.off(".tt");this.$overflowHelper.remove();this.$hint=this.$input=this.$overflowHelper=$("<div>")}});return u;function n(C){return $('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:C.css("font-family"),fontSize:C.css("font-size"),fontStyle:C.css("font-style"),fontVariant:C.css("font-variant"),fontWeight:C.css("font-weight"),wordSpacing:C.css("word-spacing"),letterSpacing:C.css("letter-spacing"),textIndent:C.css("text-indent"),textRendering:C.css("text-rendering"),textTransform:C.css("text-transform")}).insertAfter(C)}function k(D,C){return u.normalizeQuery(D)===u.normalizeQuery(C)}function o(C){return C.altKey||C.ctrlKey||C.metaKey||C.shiftKey}})();